# Rescue and Location Data Update

## Overview
This document describes the update to rescue and location data based on information from the dogadopt.github.io repository.

## Source
Data sourced from: https://github.com/dogadopt/dogadopt.github.io/blob/main/rescues.json

## Changes Made

### Migration: `20251230211953_update_rescues_and_locations_data.sql`

This migration completely replaces the existing rescue and location data with updated information from the source repository.

#### What It Does:
1. **Clears existing data**: Removes all current rescues and locations (audit logs are preserved)
2. **Inserts new rescue data**: Adds 61 unique rescue organizations
3. **Inserts location data**: Adds 62 location records (one rescue has multiple locations)

#### Data Mapping:

**From JSON to Database Schema:**

| JSON Field | Database Table | Database Field | Notes |
|------------|----------------|----------------|-------|
| `rescue_name` | `rescues` | `name` | Primary identifier |
| `country` | `rescues` | `region` | Mapped to region (England, Wales, Scotland, etc.) |
| `website` | `rescues` | `website` | Full URL with protocol |
| `lat` | `locations` | `latitude` | Geographic coordinate |
| `lng` | `locations` | `longitude` | Geographic coordinate |
| `website` + `website_dogs` | `locations` | `enquiry_url` | Combined URL for dog listings |
| `country` | `locations` | `city` | Used as city value |
| `country` | `locations` | `region` | Regional classification |

#### Coverage by Region:

- **England**: 40 rescues
- **Wales**: 9 rescues  
- **Scotland**: 5 rescues
- **Northern Ireland**: 4 rescues
- **Ireland**: 2 rescues
- **Isle of Man**: 1 rescue

#### Special Cases:

1. **Grovehill Animal Trust**: This rescue appears twice in the source data with identical information. The migration handles this by creating one rescue with two locations.

2. **Website URLs**: All website URLs are normalized to include the `https://` protocol for consistency, and proper URL path formatting is ensured.

3. **Enquiry URLs**: When available, the `website_dogs` path is appended to the main website to create direct links to dog listings.

4. **Name Spelling**: The rescue name "Airdale Terrier Club of Scotland" appears in the source data with this spelling. This is kept as-is from the source, though the correct spelling of the breed is "Airedale".

## Testing

To test this migration locally:

```bash
# Start Supabase
npm run supabase:start

# Reset database to apply migration
npm run supabase:reset

# Verify data
# Check rescue count: should be 61
# Check location count: should be 62
```

## Impact

### Audit Logs
All changes will be tracked in the audit system:
- Old rescue and location data will be logged as DELETE operations
- New rescue and location data will be logged as INSERT operations
- Complete before/after snapshots will be preserved

### Existing Dogs
Since the migrations contain NO seed dog data, this migration is safe to run on a fresh database. The old rescue data (ADCH members) and new rescue data (specific centers with coordinates) have NO overlapping rescue names, so this is a complete replacement of the rescue dataset.

**For existing databases with dog records:**
If you have an existing database with dog records that reference the old rescues:
1. Use the companion migration `20251230210855_update_dog_rescue_assignments.sql` 
2. Choose one of three options:
   - Delete all existing dogs (clean slate)
   - Set all dogs.rescue_id to NULL (manual reassignment later)
   - Manually map old rescues to new rescues

**For fresh installations:**
This migration will work perfectly as the dogs migration (2025122803) contains no seed data.

## Generated By
- Script: `scripts/generate-rescue-migration.js`
- Generated: 2025-12-30T21:08:54.867Z
- Source Data: https://github.com/dogadopt/dogadopt.github.io/blob/main/rescues.json
